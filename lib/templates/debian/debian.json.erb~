{
    "builders":
    [
        {
            "name": "debian",
            "type": "qemu",
            "iso_url": "http://cdimage.debian.org/debian-cd/<%= @data[:parameters][:version] -%>/amd64/iso-cd/debian-<%= @data[:parameters][:version] -%>-amd64-netinst.iso",
            "iso_checksum": "<%= @data[:parameters][:checksum] -%>",
            "iso_checksum_type": "sha256",
            "output_directory": "<%= @data[:output_dir] %>/debian/",
            "ssh_wait_timeout": "60m",
            "shutdown_command": "shutdown -h now",
            "format": "<%= @data[:format] %>",
            "disk_size": <%= @data[:size] %>,
            "headless": false,
            "accelerator": "kvm",
            "http_directory": "<%= @data[:server_dir] %>",
            "http_port_min": 8500,
            "http_port_max": 8550,
            "ssh_username": "root",
            "ssh_password": "<%= @data[:password] %>",
            "vm_name": "debian",
            "qemuargs": [
    				[ "-m", "1024M" ],
    				[ "--no-acpi", "" ],
    				[
       			  	"-netdev",
      			  	"user,id=mynet0,",
      			  	"hostfwd=hostip:hostport-guestip:guestport",
      			  	""
    				],
    				[ "-device", "virtio-net,netdev=mynet0" ]
  			]
            "boot_command":
              [
              "<esc>",
              " install auto=true priority=critical preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/debian.cfg",
              "<enter>"
              ]
        }
    ]<% if @data[:provisioners] -%>,

    "provisioners":
    [
        <% @data[:provisioners][:files].each_with_index do |file,i| -%>
        {
        "type": "file",
        "source": "<%= file %>",
        "destination" : "/root/<%= file.split('/').last %>"
        }<%if i != (@data[:provisioners][:files].size - 1) || (@data[:provisioners][:scripts] && !@data[:provisioners][:scripts].empty?) %>,
        <% end -%>
        <% end -%>

        <% @data[:provisioners][:scripts].each_with_index do |script,i| -%>
        {
        "type": "shell",
        "script": "<%= script %>"
        }<%unless i == (@data[:provisioners][:scripts].size - 1) %>,
        <% end -%>
        <% end -%>
    ]
    <% end -%>
}

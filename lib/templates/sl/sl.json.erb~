{ 
    "builders":
    [
	{
            "name": "sl",
            "type": "qemu",
            "iso_url": "http://mirror.karneval.cz/pub/linux/scientific/<%= @data[:parameters][:version] -%>/x86_64/iso/SL-<%= @data[:parameters][:version][0..@data[:parameters][:version].index('.')-1] -%>-x86_64-netinst.iso",
            "iso_checksum": "<%= @data[:parameters][:checksum] -%>",
            "iso_checksum_type": "sha256",
            "output_directory": "<%= @data[:output_dir] %>/sl/",
            "ssh_wait_timeout": "120m",
            "shutdown_command": "shutdown -h now",
            "format": "<%= @data[:format] %>",
            "disk_size": <%= @data[:size] %>,
            "headless": false,
            "accelerator": "kvm",
            "http_directory": "<%= @data[:server_dir] %>",
            "http_port_min": 8500,
            "http_port_max": 8550,
            "ssh_username": "root",
            "ssh_password": "<%= @data[:password] %>",
            "vm_name": "sl",
            "boot_command": 
              [
              "<esc>",
              " linux ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/sl.cfg",
              "<enter>"
              ]
        }
    ]<% if @data[:provisioners] -%>,

    "provisioners":
    [
        <% @data[:provisioners][:files].each_with_index do |file,i| -%>
        {
            "type": "file",
            "source": "<%= file %>",
            "destination" : "/root/<%= file.split('/').last %>"
        }<%if i != (@data[:provisioners][:files].size - 1) || (@data[:provisioners][:scripts] && !@data[:provisioners][:scripts].empty?) %>,
        <% end -%>
        <% end -%>

        <% @data[:provisioners][:scripts].each_with_index do |script,i| -%>
        {
            "type": "shell",
            "script": "<%= script %>"
        }<%unless i == (@data[:provisioners][:scripts].size - 1) %>,
        <% end -%>
        <% end -%>
    ]
    <% end -%>
}
